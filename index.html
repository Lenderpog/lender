<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Determination Brews - Encuesta Undertale</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  body{
    margin:0;
    padding:20px;
    font-family:"Press Start 2P", monospace;
    background:url("fondo.png") no-repeat center center fixed;
    background-size:cover;
    color:#fff;
    text-align:center;
    overflow-x:hidden;
  }
  
  /* globo del título */
  #globoTitulo{
    display:inline-block;
    background:rgba(0,0,0,0.85);
    border:4px solid #fff;
    padding:15px;
    border-radius:10px;
    margin-bottom:30px;
    max-width:600px;
    white-space:pre-line;
    position:relative;
    box-shadow:4px 4px 0 white;
  }
  #globoTitulo::after{
    content:'';
    position:absolute;
    bottom:-20px;
    left:50%;
    transform:translateX(-50%);
    border-width:10px;
    border-style:solid;
    border-color:white transparent transparent transparent;
  }

  @keyframes cambioColorUndertale{
    0%{color:#f00;text-shadow:0 0 5px #f00;}
    14%{color:#ff7f00;text-shadow:0 0 5px #ff7f00;}
    28%{color:#ff0;text-shadow:0 0 5px #ff0;}
    42%{color:#0f0;text-shadow:0 0 5px #0f0;}
    57%{color:#0ff;text-shadow:0 0 5px #0ff;}
    71%{color:#00f;text-shadow:0 0 5px #00f;}
    85%{color:#f0f;text-shadow:0 0 5px #f0f;}
    100%{color:#f00;text-shadow:0 0 5px #f00;}
  }

  form{
    background:rgba(0,0,0,0.75);
    border:2px solid white;
    border-radius:12px;
    padding:25px;
    margin:30px auto;
    max-width:400px;
  }

  label{
    display:block;
    font-size:11px;
    margin:15px 0 8px;
  }

  select, textarea, input[type=text]{
    width:100%;
    padding:10px;
    border:2px solid white;
    background:#000;
    color:#fff;
    border-radius:5px;
    font-size:12px;
    font-family:inherit;
    box-sizing:border-box;
    resize:none;
  }

  #saveBtn{
    font-family:"Press Start 2P", monospace;
    background:black;
    color:white;
    border:4px solid white;
    padding:15px 25px;
    margin-top:20px;
    font-size:14px;
    cursor:pointer;
    display:inline-block;
    box-shadow:4px 4px 0 #fff;
    animation:parpadeo 1s infinite;
    transition:all .1s ease-in-out;
  }
  #saveBtn:hover{
    background:white;
    color:black;
    box-shadow:2px 2px 0 #fff;
    transform:translate(2px,2px);
  }
  @keyframes parpadeo{
    0%,50%,100%{opacity:1;}
    25%,75%{opacity:0;}
  }

  .mensajeGlobo{
    display:none;
    opacity:0; /* inicial transparente */
    transition: opacity 0.5s ease-in-out; /* transición suave */
    background:rgba(0,0,0,0.85);
    border:4px solid white;
    padding:15px;
    border-radius:10px;
    font-family:"Press Start 2P", monospace;
    max-width:400px;
    white-space:pre-line;
    position:absolute;
    bottom:50px;
    left:50%;
    transform:translateX(-50%);
    box-shadow:4px 4px 0 white;
    color:white;
  }
  .mensajeGlobo::after{
    content:'';
    position:absolute;
    bottom:-20px;
    left:50%;
    transform:translateX(-50%);
    border-width:10px;
    border-style:solid;
    border-color:white transparent transparent transparent;
  }

  .ataque{
    position:absolute;
    width:20px;
    height:20px;
    background:red;
    clip-path:polygon(50% 0%, 0% 100%, 100% 100%);
    animation:ataqueMov 1s linear forwards;
  }
  @keyframes ataqueMov{
    0%{transform:translateY(0) scale(1);opacity:1;}
    100%{transform:translateY(-300px) scale(.5);opacity:0;}
  }
</style>
</head>

<body>
<div id="globoTitulo"></div>

<form id="miForm">
  <label>1. ¿Qué tipo de endulzante preferís?</label>
  <select name="endulzante" required>
    <option value="" disabled selected>-- Elegí una opción --</option>
    <option value="azucar">Azúcar</option>
    <option value="miel">Miel</option>
    <option value="edulcorante">Edulcorante</option>
    <option value="otro">Otro</option>
  </select>
  <textarea name="otroEndulzante" rows="1" placeholder="Si elegiste otro, ¿cuál?..."></textarea>

  <label>2. ¿Qué frutas te gustan más en un licuado?</label>
  <textarea name="frutas" rows="3" placeholder="Ej: banana, frutilla, mango..." required></textarea>

  <label>3. ¿Cuánto pagarías por un licuado?</label>
  <select name="precio" required>
    <option value="" disabled selected>-- Elegí un rango --</option>
    <option>$700 - $1000</option>
    <option>$1000 - $1500</option>
    <option>menos de $1800</option>
  </select>

  <label>4. ¿Te llamaría la atención si la persona que atiende hace cosplay?</label>
  <select name="cosplay" required>
    <option value="" disabled selected>Seleccionar</option>
    <option value="sí">Sí</option>
    <option value="no">No</option>
    <option value="depende">Depende</option>
  </select>

  <button id="saveBtn">★ VOTAR ★</button>
</form>

<div class="mensajeGlobo" id="mensajeFinal"></div>

<audio id="saveAudio" src="save.mp3"></audio>
<audio id="mensajeAudio" src="sound.mp3"></audio>
<audio id="sonidoEscritura" src="typing.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics-compat.js"></script>

<script>
  const tituloDiv = document.querySelector('#globoTitulo');
  const tituloTexto = 'Determination Drinks';
  let idx=0;
  const audioType = document.getElementById('sonidoEscritura');

  function escribirTitulo(){
    if(idx < tituloTexto.length){
      if(audioType.paused){
        audioType.loop = true;
        audioType.play().catch(()=>{});
      }
      let sp = document.createElement('span');
      sp.textContent = tituloTexto[idx];
      sp.style.animation = 'cambioColorUndertale 3s infinite';
      tituloDiv.appendChild(sp);
      idx++;
      setTimeout(escribirTitulo, 150);
    }else{
      audioType.pause();
      audioType.currentTime = 0;
    }
  }
  window.onload = escribirTitulo;

  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "encuestaundertale.firebaseapp.com",
    projectId: "encuestaundertale",
    storageBucket: "encuestaundertale.appspot.com",
    messagingSenderId: "34519487798",
    appId: "1:34519487798:web:7d53e84d8551693cf84f97",
    measurementId: "G-QMTMF22EHY"
  };
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  const db = firebase.firestore();

  const form = document.getElementById('miForm');
  const msgBox = document.getElementById('mensajeFinal');
  const palabrasBan = ["puta","mierda","idiota","estupido","gil","boludo","imbecil","tonto","gay","lesbiana","maricon","puto","pene","vagina"];

  function mostrarMensaje(txt){
    msgBox.style.opacity = 0;
    msgBox.style.display='block';
    msgBox.textContent='';
    let j=0;
    const msgAudio = document.getElementById('mensajeAudio');
    if(audioType.paused){
      audioType.loop=true;
      audioType.play().catch(()=>{});
    }
    msgAudio.play().catch(()=>{});

    const interval = setInterval(()=>{
      msgBox.textContent += txt[j];
      j++;
      if(j>=txt.length){
        clearInterval(interval);
        audioType.pause(); 
        audioType.currentTime=0;
        msgAudio.pause(); 
        msgAudio.currentTime=0;

        // fade-in del mensaje
        msgBox.style.opacity = 1;

        // fade-out después de 3 segundos
        setTimeout(()=>{
          msgBox.style.opacity = 0;
          setTimeout(()=>{ msgBox.style.display = 'none'; }, 500);
        }, 3000);
      }
    },50);
  }

  function crearAtaque(){
    const atk = document.createElement('div');
    atk.classList.add('ataque');
    atk.style.left = Math.random()*window.innerWidth + 'px';
    document.body.appendChild(atk);
    setTimeout(()=>atk.remove(),1000);
  }

  document.getElementById('saveBtn').addEventListener('click',()=>{
    document.getElementById('saveAudio').play().catch(()=>{});
  });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const data = {
      endulzante: form.endulzante.value,
      otroEndulzante: form.otroEndulzante.value.trim(),
      frutas: form.frutas.value.trim(),
      precio: form.precio.value,
      cosplay: form.cosplay.value
    };
    const textoCheck = (data.otroEndulzante + ' ' + data.frutas).toLowerCase();
    for(const palabra of palabrasBan){
      if(textoCheck.includes(palabra)){
        mostrarMensaje("¡No se permiten esas palabras!");
        crearAtaque();
        return;
      }
    }
    try{
      await db.collection('respuestas').add(data);
      mostrarMensaje("¡Gracias por tu participación!");
      form.reset();
    }catch(err){
      console.error("Error enviando a Firestore:", err);
      mostrarMensaje("Error al enviar...");
    }
  });
</script>
</body>
</html>